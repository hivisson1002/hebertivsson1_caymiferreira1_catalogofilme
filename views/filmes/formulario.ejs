<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titulo %> - Cat√°logo de Filmes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="/css/estilo.css" rel="stylesheet">
</head>
<body>
    <%- include('../partials/cabecalho') %>

    <!-- Espa√ßamento para navbar fixa -->
    <div style="height: 80px;"></div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="content-section fade-in-up">
                    <div class="text-center mb-4">
                        <h1 class="section-title">
                            <i class="fas fa-<%= acao === 'criar' ? 'plus' : 'edit' %> me-3"></i>
                            <%= titulo %>
                        </h1>
                        <p class="text-muted">Preencha as informa√ß√µes do filme abaixo</p>
                    </div>

                    <% if (typeof erro !== 'undefined') { %>
                        <div class="alert alert-danger fade-in-up" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Erro!</strong> <%= erro %>
                        </div>
                    <% } %>
                    
                    <!-- FORMUL√ÅRIO COM EMOJIS -->
                    <form method="POST" action="<%= acao === 'criar' ? '/filmes' : '/filmes/' + filme.id + '?_method=PUT' %>" id="formFilme">
                        <div class="row">
                            <!-- T√≠tulo -->
                            <div class="col-md-8 mb-3">
                                <label for="titulo" class="form-label">
                                    <i class="fas fa-film text-primary me-2"></i>
                                    T√≠tulo do Filme *
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="titulo" 
                                       name="titulo" 
                                       value="<%= filme.titulo || '' %>" 
                                       required
                                       placeholder="Ex: O Poderoso Chef√£o">
                            </div>

                            <!-- Ano -->
                            <div class="col-md-4 mb-3">
                                <label for="ano" class="form-label">
                                    <i class="fas fa-calendar text-primary me-2"></i>
                                    Ano *
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="ano" 
                                       name="ano" 
                                       value="<%= filme.ano || 2024 %>" 
                                       min="1900" 
                                       max="2030" 
                                       required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Diretor -->
                            <div class="col-md-6 mb-3">
                                <label for="diretor" class="form-label">
                                    <i class="fas fa-user-tie text-primary me-2"></i>
                                    Diretor *
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="diretor" 
                                       name="diretor" 
                                       value="<%= filme.diretor || '' %>" 
                                       required
                                       placeholder="Ex: Francis Ford Coppola">
                            </div>

                            <!-- G√™nero COM EMOJIS -->
                            <div class="col-md-6 mb-3">
                                <label for="genero" class="form-label">
                                    <i class="fas fa-tags text-primary me-2"></i>
                                    G√™nero *
                                </label>
                                <select class="form-select" id="genero" name="genero" required>
                                    <option value="">Selecione um g√™nero</option>
                                    <option value="A√ß√£o" <%= filme.genero === 'A√ß√£o' ? 'selected' : '' %>>üé¨ A√ß√£o</option>
                                    <option value="Aventura" <%= filme.genero === 'Aventura' ? 'selected' : '' %>>üó∫Ô∏è Aventura</option>
                                    <option value="Com√©dia" <%= filme.genero === 'Com√©dia' ? 'selected' : '' %>>üòÑ Com√©dia</option>
                                    <option value="Drama" <%= filme.genero === 'Drama' ? 'selected' : '' %>>üé≠ Drama</option>
                                    <option value="Fic√ß√£o Cient√≠fica" <%= filme.genero === 'Fic√ß√£o Cient√≠fica' ? 'selected' : '' %>>üöÄ Fic√ß√£o Cient√≠fica</option>
                                    <option value="Horror" <%= filme.genero === 'Horror' ? 'selected' : '' %>>üëª Horror</option>
                                    <option value="Romance" <%= filme.genero === 'Romance' ? 'selected' : '' %>>üíï Romance</option>
                                    <option value="Suspense" <%= filme.genero === 'Suspense' ? 'selected' : '' %>>üîç Suspense</option>
                                    <option value="Document√°rio" <%= filme.genero === 'Document√°rio' ? 'selected' : '' %>>üìö Document√°rio</option>
                                    <option value="Anima√ß√£o" <%= filme.genero === 'Anima√ß√£o' ? 'selected' : '' %>>üé® Anima√ß√£o</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Dura√ß√£o -->
                            <div class="col-md-6 mb-3">
                                <label for="duracao" class="form-label">
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    Dura√ß√£o (minutos) *
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="duracao" 
                                       name="duracao" 
                                       value="<%= filme.duracao || '' %>" 
                                       min="1" 
                                       required
                                       placeholder="120">
                            </div>

                            <!-- Nota -->
                            <div class="col-md-6 mb-3">
                                <label for="nota" class="form-label">
                                    <i class="fas fa-star text-warning me-2"></i>
                                    Avalia√ß√£o (0-10) - Opcional
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="nota" 
                                       name="nota" 
                                       value="<%= filme.nota || '' %>" 
                                       min="0" 
                                       max="10" 
                                       step="0.1"
                                       placeholder="Ex: 8.5">
                                <small class="form-text text-muted">
                                    Deixe em branco se n√£o quiser avaliar
                                </small>
                            </div>
                        </div>
                        
                        <!-- Sinopse -->
                        <div class="mb-4">
                            <label for="sinopse" class="form-label">
                                <i class="fas fa-align-left text-primary me-2"></i>
                                Sinopse - Opcional
                            </label>
                            <textarea class="form-control" 
                                      id="sinopse" 
                                      name="sinopse" 
                                      rows="4" 
                                      placeholder="Descreva brevemente o enredo do filme..."><%= filme.sinopse || '' %></textarea>
                        </div>
                        
                        <!-- Bot√µes -->
                        <div class="d-flex justify-content-between">
                            <a href="/filmes" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-arrow-left me-2"></i>
                                Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg" id="btnSubmit">
                                <i class="fas fa-save me-2"></i>
                                <%= acao === 'criar' ? 'Adicionar' : 'Atualizar' %> Filme
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/rodape') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('formFilme');
            const btnSubmit = document.getElementById('btnSubmit');
            const notaInput = document.getElementById('nota');
            
            // Valida√ß√£o da nota em tempo real
            notaInput.addEventListener('input', function() {
                const valor = parseFloat(this.value);
                if (this.value !== '' && (isNaN(valor) || valor < 0 || valor > 10)) {
                    this.classList.add('is-invalid');
                    this.setCustomValidity('A nota deve estar entre 0 e 10');
                } else {
                    this.classList.remove('is-invalid');
                    this.setCustomValidity('');
                }
            });
            
            form.addEventListener('submit', function(e) {
                console.log('üìù Formul√°rio sendo enviado...');
                
                // Valida√ß√£o final da nota
                const notaValor = notaInput.value;
                if (notaValor !== '' && (parseFloat(notaValor) < 0 || parseFloat(notaValor) > 10)) {
                    e.preventDefault();
                    alert('A nota deve estar entre 0 e 10');
                    return;
                }
                
                // Mostrar loading
                btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Salvando...';
                btnSubmit.disabled = true;
            });
        });
    </script>
</body>
</html>
